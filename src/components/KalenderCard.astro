---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import Text from "./Text.astro";
import Heading from "./Heading.astro";

type EventEntry = { time: string; title: string; subtitle?: string };

type KalenderCardProps = {
  dateLabel: string;
  events?: EventEntry[];
  image?: ImageMetadata;
  imageAlt?: string;
  backgroundColor?: string;
};

const {
  dateLabel,
  events = [],
  image,
  imageAlt,
  backgroundColor,
} = Astro.props as KalenderCardProps;

const fallbackColor = backgroundColor || "var(--color-primary-green)";
const dayOnly = dateLabel.split(".")[0]; // Ekstraher kun dagen (f.eks. "01" fra "01.12")
---

<article class="relative flex flex-col h-full">
  <div class="p-3xs md:p-3xs flex flex-col h-full">
    <div class="hidden md:grid gap-4xs flex-grow">
      {
        events.length ? (
          events.map((item) => (
            <div class="grid grid-cols-[auto_1fr] gap-4xs items-start">
              <Text
                teksttype="billedtekst"
                stylingclasses="m-0 font-bold text-text-dark leading-tight"
              >
                {item.time}
              </Text>
              <div class="flex flex-col gap-[2px]">
                <Text
                  teksttype="billedtekst"
                  stylingclasses="m-0 font-bold text-text-dark leading-tight"
                >
                  {item.title}
                </Text>
                {item.subtitle && (
                  <Text
                    teksttype="billedtekst"
                    stylingclasses="m-0 text-text-dark leading-tight"
                  >
                    {item.subtitle}
                  </Text>
                )}
              </div>
            </div>
          ))
        ) : (
          <Text
            teksttype="billedtekst"
            stylingclasses="text-text-dark font-semibold"
          >
            Ingen aktiviteter
          </Text>
        )
      }
    </div>

    <div
      class="flex flex-col items-end gap-4xs md:items-end md:gap-4xs md:mb-[72px] mobile:items-center mobile:justify-center"
    >
      <Heading
        htmlheading="h4"
        size="xsmallbold"
        stylingclasses="text-text-dark text-right leading-none"
      >
        <span class="hidden md:inline">{dateLabel}</span>
        <span class="md:hidden text-xl">{dayOnly}</span>
      </Heading>
      {
        events.length > 0 && (
          <div class="w-2 h-2 md:w-2 md:h-2 rounded-full bg-primary-pink md:hidden mobile:w-[6px] mobile:h-[6px]" />
        )
      }
    </div>
  </div>

  <div
    class="hidden md:block absolute bottom-0 left-0 right-0 h-20 overflow-hidden"
    style={`background-color: ${fallbackColor}`}
  >
    {
      image ? (
        <Image
          src={image}
          alt={imageAlt || dateLabel}
          class="absolute inset-0 w-full h-full object-cover"
        />
      ) : null
    }
  </div>
</article>

<style>
  @media (max-width: 768px) {
    article > div:first-child {
      padding: var(--spacing-4xs);
      gap: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    article > div:first-child > div:first-child {
      display: none !important;
    }

    article > div:first-child > div:last-child {
      align-items: center;
      justify-content: center;
    }
  }
</style>
