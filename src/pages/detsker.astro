---
import MainLayout from "../layouts/MainLayout.astro";
import KalenderCard from "../components/KalenderCard.astro";
import Heading from "../components/Heading.astro";
import Text from "../components/Text.astro";
import Button from "../components/Button.astro";
import type { ImageMetadata } from "astro";
import NewsCard from "../components/NewsCard.astro";

const dayNames = ["Man", "Tirs", "Ons", "Tors", "Fre", "Lør", "Søn"];

type EventEntry = { time: string; title: string; subtitle?: string };
type CalendarCell = {
  dateLabel: string;
  events: EventEntry[];
  image?: ImageMetadata;
  backgroundColor?: string;
} | null;

const primaryColors = [
  "var(--color-primary-green)",
  "var(--color-primary-pink)",
  "var(--color-primary-blue)",
  "var(--color-primary-turquoise)",
  "var(--color-primary-dustyyellow)",
];

// Data for news section with categories
type NewsItem = {
  date: string;
  title: string;
  description: string;
  imageSrc: string;
  imageAlt: string;
  category: "nyheder" | "forskning" | "arrangementer";
};

const newsItems: NewsItem[] = [
  {
    date: "5. DECEMBER",
    title: "Symposium for kunstnere og co-terapeuter",
    description:
      "Fredag var alle kreative og co-terapeuter inviteret til symposium hos CKMS, der for første gang havde mulighed for at samle alle på denne måde i den stemmingsfulde Kirkesal.",
    imageSrc: "/img/news1.webp",
    imageAlt: "Gruppe mennesker samlet i kirkesal",
    category: "nyheder",
  },
  {
    date: "2. DECEMBER",
    title: "Ny skrivegruppe på vej i Vordingborg",
    description:
      "Sneen falder tæt over Vordingborg, da CKMS er på besøg hos Region Sjælland for at lave Åben Skrivecafé for brugere af psykiatrien. Skrivecaféen er en smagssprøve på, hvordan en",
    imageSrc: "/img/news2.webp",
    imageAlt: "To kvinder smiler til kameraet",
    category: "arrangementer",
  },
  {
    date: "28. NOVEMBER",
    title: "Super god eftermiddag da Åben Scene og Åben Skrivecafé 'mødtes'",
    description:
      "Tak for alle, der var mødt op til Åben Scene torsdag. Det var en super god eftermiddag. Igen havde vi besøg af tre musikere fra Rytmekons. Denne gang havde Jonas Engell,",
    imageSrc: "/img/news3.webp",
    imageAlt: "Folk sidder sammen til workshop",
    category: "nyheder",
  },
  {
    date: "21. NOVEMBER",
    title: "Forskningsrapport: Deltagerfokuseret kunst og trivsel",
    description:
      "Ny foranalyse peger på positive effekter af deltagerfokuserede kunstforløb i psykiatrien, bl.a. øget trivsel og fællesskab.",
    imageSrc: "/img/news4.png",
    imageAlt: "Præsentation i sal",
    category: "forskning",
  },
  {
    date: "16. NOVEMBER",
    title: "Åben Scene – ekstra dato",
    description:
      "Efter stor efterspørgsel har vi åbnet en ekstra Åben Scene-session i december.",
    imageSrc: "/img/news5.png",
    imageAlt: "Publikum klapper",
    category: "arrangementer",
  },
  {
    date: "10. NOVEMBER",
    title: "Publikation: Kunst, omsorg og fællesskab",
    description:
      "CKMS udgiver en ny publikation om kunst, omsorg og fællesskab i samarbejde med forskere og praktikere.",
    imageSrc: "/img/news6.png",
    imageAlt: "Bog og noter",
    category: "forskning",
  },
];

const decemberCells: CalendarCell[] = [
  {
    dateLabel: "01.12",
    events: [
      {
        time: "11:00 - 14:00",
        title: "Skrivgruppe med Claus",
        subtitle: "Holbæk, Danmark",
      },
    ],
    backgroundColor: primaryColors[0],
  },
  {
    dateLabel: "02.12",
    events: [
      {
        time: "10:00 - 12:00",
        title: "Foto walk",
        subtitle: "Frederiksberg, Danmark",
      },
    ],
    backgroundColor: primaryColors[1],
  },
  {
    dateLabel: "03.12",
    events: [
      {
        time: "13:00 - 15:00",
        title: "Åben atelierdag",
        subtitle: "København, Danmark",
      },
    ],
    backgroundColor: primaryColors[2],
  },
  // 04-31 uden events
  ...Array.from({ length: 28 }).map((_, idx) => ({
    dateLabel: `${String(idx + 4).padStart(2, "0")}.12`,
    events: [],
    backgroundColor: primaryColors[(idx + 3) % primaryColors.length],
  })),
  // Filler-celler for at nå 7x5 (35 felter)
  null,
  null,
  null,
  null,
];
---

<MainLayout title="Det sker">
  <!-- ***************************** Start Eventkalender ***************************** -->

  <section class="mx-2xs md:mx-l py-m md:py-l">
    <div class="flex flex-col gap-xs md:gap-m">
      <Heading htmlheading="h1" size="large" class="text-text-dark">
        Eventkalender
      </Heading>
      <Heading htmlheading="h2" size="medium" class="text-text-dark">
        December
      </Heading>
    </div>

    <div class="relative overflow-hidden">
      <div
        class="grid grid-cols-7 border-t-2 border-b-2 border-text-dark py-2xs md:py-3xs"
      >
        {
          dayNames.map((day) => (
            <div class="text-center">
              <Heading
                htmlheading="h4"
                size="xsmallbold"
                stylingclasses="text-text-dark"
              >
                {day}
              </Heading>
            </div>
          ))
        }
      </div>

      <div
        class="grid grid-cols-7 border-l-2 border-r-2 border-b-2 border-text-dark overflow-hidden"
      >
        {
          decemberCells.map((cell, idx) => (
            <div class="border-r-2 border-b-2 border-text-dark overflow-hidden aspect-[3/4]">
              {cell ? (
                <button
                  class="h-full w-full text-left "
                  type="button"
                  data-day-index={idx}
                  data-date={cell.dateLabel}
                  data-events={encodeURIComponent(JSON.stringify(cell.events))}
                  aria-label={`Åbn detaljer for ${cell.dateLabel}`}
                >
                  <KalenderCard
                    dateLabel={cell.dateLabel}
                    events={cell.events}
                    image={cell.image}
                    backgroundColor={cell.backgroundColor}
                  />
                </button>
              ) : (
                <div class="w-full h-full" />
              )}
            </div>
          ))
        }
      </div>

      <!-- Mobile Detail Panel -->
      <div
        class="w-full border-2 border-text-dark overflow-hidden transition-all duration-300 md:hidden"
        id="mobile-day-detail"
        data-detail-panel
        class="w-full border-2 border-text-dark overflow-hidden transition-all duration-300 md:hidden max-h-0"
      >
        <div class="p-2xs md:p-2xs overflow-y-auto">
          <div class="flex items-center justify-between mb-m">
            <div
              class="text-xl md:text-xl font-black text-text-dark"
              data-detail-date
            >
              -
            </div>
            <button
              type="button"
              class="text-xl text-text-dark h"
              aria-label="Luk"
              data-close-btn>✕</button
            >
          </div>
          <ul class="space-y-s md:space-y-m" data-detail-list></ul>
          <div class="text-center py-m" data-detail-empty>
            <Text teksttype="brødtekst" stylingclasses="text-text-dark">
              Vælg en dag for at se detaljer.
            </Text>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- ***************************** End Eventkalender ***************************** -->

  <!-- ***************************** Start Nyt fra CKMS ***************************** -->

  <section class="mx-2xs md:mx-l">
    <Heading
      htmlheading="h2"
      size="medium"
      stylingclasses="mb-xs md:mb-m animate-fade-right"
      >Nyt fra CKMS
    </Heading>
    <!-- Filter/Search bar -->
    <div class="relative mb-xs md:mb-s py-2">
      <div
        class="flex items-center gap-6 md:gap-8 flex-1 border-b-2 border-text-dark pb-1"
      >
        <button
          type="button"
          class="px-3 py-2 text-text-dark hover:opacity-80"
          data-news-filter="alle"
        >
          <Text as="span" teksttype="brødtekst" stylingclasses="text-text-dark"
            >Se alle</Text
          >
        </button>
        <button type="button" class="text-text-dark" data-news-filter="nyheder">
          <Text as="span" teksttype="brødtekst" stylingclasses="text-text-dark"
            >Nyheder</Text
          >
        </button>
        <button
          type="button"
          class="text-text-dark"
          data-news-filter="forskning"
        >
          <Text as="span" teksttype="brødtekst" stylingclasses="text-text-dark"
            >Forskning</Text
          >
        </button>
        <button
          type="button"
          class="text-text-dark"
          data-news-filter="arrangementer"
        >
          <Text as="span" teksttype="brødtekst" stylingclasses="text-text-dark"
            >Arrangementer</Text
          >
        </button>
        <div class="ml-auto flex items-center gap-2">
          <input
            id="news-search"
            type="text"
            placeholder="Søg"
            class="bg-transparent outline-none text-text-dark placeholder-text-dark/70 w-[160px] md:w-[240px] text-[18px] md:text-[22px] font-light font-onsite"
          />
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"
            ></circle>
            <path
              d="M20 20L17 17"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"></path>
          </svg>
        </div>
      </div>
    </div>

    <!-- Mobile/tablet: carousel under lg -->
    <div class="lg:hidden mb-xs" id="news-mobile">
      <div class="carousel w-full gap-2xs" data-news-list>
        {
          newsItems.map((item) => (
            <div
              class="carousel-item w-2/3"
              data-news-card
              data-category={item.category}
              data-search={(item.title + " " + item.description).toLowerCase()}
            >
              <NewsCard
                date={item.date}
                title={item.title}
                description={item.description}
                imageSrc={item.imageSrc}
                imageAlt={item.imageAlt}
                linkText="Læs mere"
              />
            </div>
          ))
        }
      </div>
    </div>

    <!-- Desktop: grid on lg and up -->
    <div
      class="hidden lg:grid grid-cols-3 gap-2xs mb-m"
      id="news-desktop"
      data-news-grid
    >
      {
        newsItems.map((item) => (
          <div
            data-news-card
            data-category={item.category}
            data-search={(item.title + " " + item.description).toLowerCase()}
          >
            <NewsCard
              date={item.date}
              title={item.title}
              description={item.description}
              imageSrc={item.imageSrc}
              imageAlt={item.imageAlt}
              linkText="Læs mere"
            />
          </div>
        ))
      }
    </div>
    <div class="flex justify-center">
      <Button>Se flere</Button>
    </div>
  </section>
  <!-- ***************************** End Nyt fra CKMS ***************************** -->

  <!-- ***************************** Start Udstillinger ***************************** -->
  <section>
    <div class="mx-2xs md:mx-l">
      <Heading htmlheading="h2" size="medium" stylingclasses="text-text-dark">
        Udstillinger
      </Heading>
    </div>

    <div class="flex items-center justify-between px-2xs md:px-0 mb-2xs">
      <button
        id="aktivitet-prev"
        class="nav-button w-[50px] h-[50px]"
        aria-label="Forrige"
      >
        <img src="/img/pilleft.svg" alt="Forrige" class="w-full h-full" />
      </button>
      <button
        id="aktivitet-next"
        class="nav-button w-[50px] h-[50px]"
        aria-label="Næste"
      >
        <img src="/img/pilright.svg" alt="Næste" class="w-full h-full" />
      </button>
    </div>

    <div
      class="overflow-x-auto snap-x snap-mandatory flex gap-xs"
      id="udstillinger-carousel"
    >
      <!-- Card 1 -->
      <article
        class="min-w-[90%] md:min-w-[80%] snap-start bg-udstilling-1-card text-text-light px-2xs md:px-s py-2xs md:py-s space-y-s"
      >
        <!-- Top heading -->
        <div>
          <Heading
            htmlheading="h3"
            size="large"
            stylingclasses="text-text-light"
          >
            are you mad yet?
          </Heading>
        </div>

        <!-- Two-column content: left text, right main image -->
        <div class="grid gap-s lg:grid-cols-2 items-start">
          <div class="space-y-xs md:space-y-s">
            <Text teksttype="brødtekst" stylingclasses="text-text-light">
              are you mad yet? kaster lys på de økonomiske reformer, som rammer
              de syge i vores samfund. Udstillingen fungerer som skole for en ny
              form for psykoedukation. Psykoedukation er læren om egen psyke, og
              indgår i psykiatrisk behandling. I denne skole flyttes fokus
            </Text>
          </div>
          <div class="w-full h-[200px] md:h-[230px] lg:h-[250px]">
            <img
              src="/img/udstilling1.webp"
              alt="Are you mad yet? udstilling"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        </div>

        <!-- Bottom row: four square thumbnails (desktop only) -->
        <div class="hidden md:grid md:grid-cols-4 gap-2xs md:gap-xs">
          <div class="w-full aspect-square">
            <img
              src="/img/instagram1.png"
              alt="Are you mad yet? detalje 1"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="w-full aspect-square">
            <img
              src="/img/instagram2.png"
              alt="Are you mad yet? detalje 2"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="w-full aspect-square">
            <img
              src="/img/instagram3.png"
              alt="Are you mad yet? detalje 3"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="w-full aspect-square">
            <img
              src="/img/instagram4.png"
              alt="Are you mad yet? detalje 4"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        </div>
      </article>

      <!-- Card 2 -->
      <article
        class="min-w-[90%] md:min-w-[80%] snap-start bg-udstilling-2-card text-text-light px-2xs md:px-s py-2xs md:py-s space-y-s"
      >
        <!-- Top heading -->
        <div>
          <Heading
            htmlheading="h3"
            size="large"
            stylingclasses="text-text-light"
          >
            Bobbi Johanne-Østervang
          </Heading>
        </div>

        <!-- Two-column content: left image, right text -->
        <div class="grid gap-s lg:grid-cols-2 items-start">
          <div class="w-full h-[200px] md:h-[230px] lg:h-[250px]">
            <img
              src="/img/udstilling2.webp"
              alt="Bobbi Johanne-Østervang værk"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="space-y-xs md:space-y-s">
            <Heading
              htmlheading="h4"
              size="xsmall"
              stylingclasses="text-text-light"
            >
              De Har Aftaler
            </Heading>
            <Text
              teksttype="brødtekst"
              stylingclasses="text-text-light max-w-[560px]"
            >
              De Har Aftaler undersøger det mentale rod, der kan opstå under og
              efter sygdom. Små væsener bevæger sig gennem kognitionens lag og
              forstyrrer hverdagens strukturer som “kognitive dæmoner”.
              Udstillingen bygger på kunstnerens egne erfaringer med
              psykoedukation og kritiserer systemer, der gør psykisk sygdom til
              et individuelt ansvar.
            </Text>
          </div>
        </div>

        <!-- Bottom row: full-width supporting text (desktop only) -->
        <div class="hidden md:block">
          <Text teksttype="brødtekst" stylingclasses="text-text-light">
            Den omfatter malerier og en kunstpublikation, som også findes som
            lydbog. Lydspor og poetiske fortolkninger af Anna Rieder kan opleves
            via QR-koder og senere her på siden.
          </Text>
        </div>
      </article>

      <!-- Card 3 -->
      <article
        class="min-w-[90%] md:min-w-[80%] snap-start bg-udstilling-3-card text-text-dark px-2xs md:px-s py-2xs md:py-s space-y-s"
      >
        <!-- Top heading -->
        <div>
          <Heading
            htmlheading="h3"
            size="large"
            stylingclasses="text-text-dark"
          >
            M / Other (2021)
          </Heading>
        </div>

        <!-- Two-column content: left text, right image -->
        <div class="grid gap-s lg:grid-cols-2 items-start">
          <div class="space-y-xs md:space-y-s">
            <Text
              teksttype="brødtekst"
              stylingclasses="text-text-dark max-w-[620px]"
            >
              M / Other (2021) var CKMS’ første udstilling, hvor
              samtidskunstnere undersøgte moderskab gennem en interaktiv
              kunstinstallation. Udstillingen skabte et kurateret møde mellem
              værker om sorg og omsorg, sårbarhed og solidaritet, og undersøgte
              moderskab i en udvidet forståelse — som noget, der rækker ud over
              biologi og traditionelle familieformer. Den spurgte ind til, hvad
              det vil sige at høre sammen, skabe bånd og danne familie på andre
              måder end gennem blod.
            </Text>
            <Text teksttype="brødtekst" stylingclasses="text-text-dark">
              Fotos: Amanda Bødker
            </Text>
          </div>
          <div class="w-full h-[200px] md:h-[230px] lg:h-[250px]">
            <img
              src="/img/udstilling3.webp"
              alt="M / Other udstilling"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        </div>

        <!-- Bottom row: three images (desktop only) -->
        <div class="hidden md:grid md:grid-cols-3 gap-2xs md:gap-xs">
          <div class="w-full h-[140px] md:h-[180px]">
            <img
              src="/img/news1.webp"
              alt="M / Other detalje 1"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="w-full h-[140px] md:h-[180px]">
            <img
              src="/img/news2.webp"
              alt="M / Other detalje 2"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="w-full h-[140px] md:h-[180px]">
            <img
              src="/img/news3.webp"
              alt="M / Other detalje 3"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
        </div>
      </article>

      <!-- Card 4 -->
      <article
        class="min-w-[90%] md:min-w-[80%] snap-start bg-udstilling-4-card text-text-light px-2xs md:px-s py-2xs md:py-s space-y-s"
      >
        <!-- Top heading -->
        <div>
          <Heading
            htmlheading="h3"
            size="large"
            stylingclasses="text-text-light"
          >
            Ømme Knapper
          </Heading>
        </div>

        <!-- Two-column content: left image, right text -->
        <div class="grid gap-s lg:grid-cols-2 items-start">
          <div class="w-full h-[200px] md:h-[230px] lg:h-[250px]">
            <img
              src="/img/udstilling4.webp"
              alt="Ømme Knapper illustration"
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="space-y-xs md:space-y-s">
            <Text
              teksttype="brødtekst"
              stylingclasses="text-text-light max-w-[560px]"
            >
              Ømme Knapper er et kunstnerisk rum lavet af og for
              psykiatribrugere, deres pårørende, psykiatriske behandlere – og
              kunstinteresserede. Udstillingsplatformen Ømme Knapper en et
              udstillings- og samlingssted for samtidskunst og omsorgsaktivisme,
              der taler fra sårbarhedens sted. Udstillingsplatformen undersøger
              synet på mental sundhed og ømhedsbegrebet fra en kunstnerisk
              vinkel, der både udfordrer, kritiserer og samarbejder med det
              psykiatriske system.
            </Text>
          </div>
        </div>

        <!-- Bottom image (desktop only) -->
        <div class="hidden md:block w-full">
          <img
            src="/img/fireikoner.svg"
            alt="Støttepartnere"
            class="w-[50%] h-[50%] object-contain"
            loading="lazy"
          />
        </div>
      </article>
    </div>
  </section>
  <!-- ***************************** End Udstillinger ***************************** -->

  <!-- ***************************** Start Bestil et foredrag ***************************** -->
  <section class="bg-background-v4 p-m md:py-l mt-l mb-l">
    <div>
      <div class="mb-2xs md:mb-m">
        <Heading
          htmlheading="h2"
          size="medium"
          stylingclasses="text-text-light"
        >
          Bestil et foredrag
        </Heading>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-xs md:gap-m">
        <!-- Left column -->
        <div class="space-y-xs md:space-y-s">
          <Heading
            htmlheading="h4"
            size="xsmall"
            stylingclasses="text-text-light"
          >
            CKMS tilbyder foredrag, workshops og kurser
          </Heading>
          <Text teksttype="brødtekst" stylingclasses="text-text-light">
            Skriv til os hvis du er interesseret i at bestille et foredrag. Vi
            sammensætter gerne et skræddersyet program.
          </Text>
          <Button variant="light">Skriv til os</Button>
        </div>

        <!-- Right column -->
        <div>
          <Text teksttype="brødtekst" stylingclasses="text-text-light">
            Hvis du er et museum eller udstillingssted tilbyder vi også
            rådgivning angående inklusion af psykiatribrugere i jeres
            programmer. Vi kan også tilbyde kortere skriveforløb ved vores
            forfattere som en metode til at åbne et udstillingsrum og dets
            genstande på, hvilket vi fx har gjort i samarbejde med
            Arbejdermuseet, Medicinsk Museion, Statens Museum for Kunst,
            Overgaden ovenvande.
          </Text>
        </div>
      </div>
    </div>
  </section>
  <!-- ***************************** End Bestil et foredrag ***************************** -->

  <script>
    const detailPanel = document.getElementById("mobile-day-detail");
    const dateEl = detailPanel?.querySelector("[data-detail-date]");
    const listEl = detailPanel?.querySelector("[data-detail-list]");
    const emptyEl = detailPanel?.querySelector("[data-detail-empty]");
    const closeBtn = detailPanel?.querySelector("[data-close-btn]");
    const isMobile = window.matchMedia("(max-width: 767px)");

    function closePanel() {
      if (detailPanel) {
        detailPanel.style.maxHeight = "0";
      }
    }

    function openPanel() {
      if (detailPanel) {
        detailPanel.style.maxHeight = "80vh";
      }
    }

    function renderDetail(dateLabel, events) {
      if (!detailPanel || !isMobile.matches) return;

      if (dateEl) dateEl.textContent = dateLabel;

      if (listEl) {
        listEl.innerHTML = "";

        if (events.length > 0) {
          emptyEl?.classList.add("hidden");
          events.forEach((evt) => {
            const li = document.createElement("li");
            li.className = "rounded-lg p-xs md:p-s";

            const time = document.createElement("div");
            time.className =
              "text-[18px] md:text-[22px] font-light font-onsite text-text-dark mb-xs";
            time.textContent = evt.time;
            li.appendChild(time);

            const title = document.createElement("div");
            title.className =
              "text-[18px] md:text-[22px] font-light font-onsite text-text-dark";
            title.textContent = evt.title;
            li.appendChild(title);

            if (evt.subtitle) {
              const subtitle = document.createElement("div");
              subtitle.className =
                "text-[18px] md:text-[22px] font-light font-onsite text-text-dark mt-xs";
              subtitle.textContent = evt.subtitle;
              li.appendChild(subtitle);
            }

            listEl.appendChild(li);
          });
        } else {
          emptyEl?.classList.remove("hidden");
        }
      }

      openPanel();
    }

    function handleClick(event) {
      const target = event.currentTarget;
      if (!(target instanceof HTMLElement)) return;
      const dateLabel = target.dataset.date;
      const rawEvents = target.dataset.events;
      if (!dateLabel || rawEvents === undefined) return;
      try {
        const events = JSON.parse(decodeURIComponent(rawEvents));
        renderDetail(dateLabel, events);
      } catch (err) {
        console.error("Kunne ikke læse event data", err);
      }
    }

    function bindMobileClicks() {
      if (!isMobile.matches) return;
      document.querySelectorAll("[data-day-index]").forEach((button) => {
        button.removeEventListener("click", handleClick);
        button.addEventListener("click", handleClick);
      });
    }

    closeBtn?.addEventListener("click", closePanel);

    bindMobileClicks();
    isMobile.addEventListener("change", bindMobileClicks);

    // Udstillinger carousel nav
    const carousel = document.getElementById("udstillinger-carousel");
    const prevBtn = document.getElementById("aktivitet-prev");
    const nextBtn = document.getElementById("aktivitet-next");

    function scrollCarousel(direction) {
      if (!carousel) return;
      const scrollAmount = carousel.clientWidth * 0.8;
      carousel.scrollBy({
        left: direction === "left" ? -scrollAmount : scrollAmount,
        behavior: "smooth",
      });
    }

    prevBtn?.addEventListener("click", () => scrollCarousel("left"));
    nextBtn?.addEventListener("click", () => scrollCarousel("right"));

    // News filter + search
    const filterButtons = Array.from(
      document.querySelectorAll("[data-news-filter]")
    ) as HTMLButtonElement[];
    const searchInput = document.getElementById(
      "news-search"
    ) as HTMLInputElement | null;
    const cards = Array.from(
      document.querySelectorAll("[data-news-card]")
    ) as HTMLElement[];

    let currentCategory: "alle" | "nyheder" | "forskning" | "arrangementer" =
      "alle";
    let currentQuery = "";

    function applyNewsFilters() {
      const q = currentQuery.trim().toLowerCase();
      cards.forEach((el) => {
        const cat = (el.getAttribute("data-category") || "").toLowerCase();
        const hay = (el.getAttribute("data-search") || "").toLowerCase();
        const matchCat = currentCategory === "alle" || cat === currentCategory;
        const matchQuery = q === "" || hay.includes(q);
        el.classList.toggle("hidden", !(matchCat && matchQuery));
      });

      // active state styling: add border box around active filter button
      filterButtons.forEach((btn) => {
        const isActive =
          btn.getAttribute("data-news-filter") === currentCategory;
        btn.classList.toggle("px-3", isActive);
        btn.classList.toggle("py-2", isActive);
        btn.classList.toggle("border-2", isActive);
        btn.classList.toggle("border-text-dark", isActive);
        btn.classList.toggle("opacity-60", !isActive);
      });
    }

    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const val = (btn.getAttribute("data-news-filter") ||
          "alle") as typeof currentCategory;
        currentCategory = val;
        applyNewsFilters();
      });
    });

    searchInput?.addEventListener("input", (e) => {
      const target = e.target as HTMLInputElement;
      currentQuery = target.value || "";
      applyNewsFilters();
    });

    // initial
    applyNewsFilters();
  </script>
</MainLayout>
