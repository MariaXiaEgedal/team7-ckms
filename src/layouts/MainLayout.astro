---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/tailwind.css";
const { title } = Astro.props;
---

<html lang="en" data-theme="">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="generator" content={Astro.generator} />
    <title>{Astro.props.title}</title>
    <script
      src="https://unpkg.com/tailwindcss-intersect@2.x.x/dist/observer.min.js"
    ></script>
  </head>
  <body class="bg-background-primary">
    <!-- Password Gate Overlay -->
    <div
      id="password-gate"
      class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[9999] transition-opacity duration-300"
    >
      <div
        class="bg-white rounded-lg p-8 md:p-12 max-w-md w-full mx-4 shadow-2xl"
      >
        <h1 class="text-2xl md:text-3xl font-bold text-text-dark mb-4">
          Redesign Projekt
        </h1>
        <p class="text-text-dark mb-6 text-sm md:text-base">
          Dette site er under redesign. Indtast koden for at få adgang.
        </p>

        <div class="space-y-4">
          <input
            id="password-input"
            type="password"
            placeholder="Indtast kode"
            class="w-full px-4 py-3 border-2 border-text-dark rounded-lg font-onsite text-text-dark placeholder-text-dark placeholder-opacity-50 focus:outline-none focus:border-primary-pink transition-colors"
          />

          <button
            id="password-submit"
            type="button"
            class="w-full px-6 py-3 bg-text-dark text-white font-bold rounded-lg hover:bg-opacity-80 transition-all active:scale-95"
          >
            Adgang
          </button>

          <div
            id="password-error"
            class="hidden text-red-600 text-sm text-center font-semibold"
          >
            Forkert kode. Prøv igen.
          </div>
        </div>
      </div>
    </div>

    <header class="sticky top-0 z-50">
      <Header />
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <Footer />
    </footer>

    <script>
      // Password Gate Logic
      const CORRECT_PASSWORD = "ckms2025";
      const STORAGE_KEY = "accessGranted";

      const gateOverlay = document.getElementById("password-gate");
      const passwordInput = document.getElementById("password-input");
      const passwordSubmit = document.getElementById("password-submit");
      const passwordError = document.getElementById("password-error");

      // Check if access already granted
      function checkAccess() {
        if (sessionStorage.getItem(STORAGE_KEY) === "true") {
          hideGate();
        }
      }

      // Hide gate
      function hideGate() {
        gateOverlay.classList.add("opacity-0", "pointer-events-none");
        setTimeout(() => {
          gateOverlay.style.display = "none";
        }, 300);
      }

      // Handle password submission
      function handleSubmit() {
        const enteredPassword = passwordInput.value.trim();

        if (enteredPassword === CORRECT_PASSWORD) {
          sessionStorage.setItem(STORAGE_KEY, "true");
          passwordError.classList.add("hidden");
          hideGate();
        } else {
          passwordError.classList.remove("hidden");
          passwordInput.value = "";
          passwordInput.focus();

          // Hide error after 3 seconds
          setTimeout(() => {
            passwordError.classList.add("hidden");
          }, 3000);
        }
      }

      // Event listeners
      passwordSubmit.addEventListener("click", handleSubmit);
      passwordInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          handleSubmit();
        }
      });

      // Focus input on load
      passwordInput.focus();

      // Check access on page load
      checkAccess();
    </script>
  </body>
</html>
